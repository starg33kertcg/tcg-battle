<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TCG Battle!</title>
    <link rel="icon" type="image/png" href="https://tcgbattle.netlify.app/images/tcg_battle_logo.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://js.pusher.com/8.2.0/pusher.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .font-bangers { font-family: 'Bangers', cursive; }
        .logo-text { text-shadow: 4px 4px 0px #1f2937, -2px -2px 0 #1f2937, 2px -2px 0 #1f2937, -2px 2px 0 #1f2937, 2px 2px 0 #1f2937; }
        .disabled-card { filter: grayscale(100%); cursor: not-allowed; }
        .prize-card { transition: all 0.3s ease; border: 2px solid #6b7280; }
        .prize-card.taken {  
            background-color: #4b5563 !important;  
            color: #9ca3af !important;  
            transform: scale(0.95);  
            border-color: #374151;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }
        .turn-indicator-glow { box-shadow: 0 0 15px 4px #22c55e; animation: pulse-green 2s infinite; }
        @keyframes pulse-green { 0% { box-shadow: 0 0 15px 4px #22c55e; } 70% { box-shadow: 0 0 20px 6px #16a34a; } 100% { box-shadow: 0 0 15px 4px #22c55e; } }
        .modal-backdrop { background-color: rgba(0,0,0,0.75); }

        /* New Presenter Styles */
        .presenter-prize-container {
            position: relative;
            width: 450px; /* Increased container size for larger arc */
            height: 450px;
        }
        .presenter-prize-pokeball {
            position: absolute;
            left: 50%;
            top: 50%;
            margin: -32px; /* Half of new width/height */
            width: 64px;   /* Increased size */
            height: 64px;  /* Increased size */
            border-radius: 50%;
            background: linear-gradient(to bottom, #ef4444 0%, #ef4444 50%, #f9fafb 50%, #f9fafb 100%);
            border: 3px solid #1f2937; /* Thicker border */
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .presenter-prize-pokeball::before {
            content: '';
            position: absolute;
            height: 8px; /* Thicker line */
            width: 100%;
            background: #1f2937;
        }
        .presenter-prize-pokeball::after {
            content: '';
            position: absolute;
            height: 22px; /* Larger button */
            width: 22px;  /* Larger button */
            border-radius: 50%;
            background: #f9fafb;
            border: 5px solid #1f2937; /* Thicker border */
        }
        .presenter-prize-pokeball.taken {
            filter: grayscale(100%);
        }
        
        /* Winner Animation */
        @keyframes winner-pop {
            0% { transform: scale(0.5); opacity: 0; }
            70% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        .winner-animation {
            animation: winner-pop 0.5s ease-out forwards;
        }

        /* Lorcana Styles */
        .lore-icon-glow {
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.8));
        }
    </style>
</head>
<body class="text-gray-100" style="background-color: #1a1a2e;">

    <div id="app" class="relative min-h-screen">

        <section id="home-view" class="hidden min-h-screen flex flex-col items-center justify-center p-4 text-center">
            <div class="mb-8 w-full max-w-lg">
                <img src="https://tcgbattle.netlify.app/images/tcg_battle_logo.png" alt="TCG Battle Logo" class="w-full h-auto">
            </div>
            <div class="space-y-4 w-full max-w-xs">
                <button id="create-session-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg text-xl shadow-lg transition-transform transform hover:scale-105">Create a new battle</button>
                <button id="join-session-btn" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg text-xl shadow-lg transition-transform transform hover:scale-105">Join an existing battle</button>
            </div>
            <div class="absolute bottom-4 text-xs text-gray-500">
                <p>This app is under active development. Expect bugs and glitches.</p>
            </div>
        </section>

        <section id="tcg-selection-view" class="hidden min-h-screen flex flex-col items-center justify-center p-4">
            <h2 class="text-4xl font-bold mb-8">Choose Your TCG</h2>
            <div class="grid grid-cols-2 md:grid-cols-3 gap-4 w-full max-w-2xl">
                <div id="select-pokemon" class="bg-gray-700 p-4 rounded-lg text-center cursor-pointer border-2 border-transparent hover:border-yellow-400 hover:bg-gray-600 transition-colors">
                    <img src="https://assets.pokemon.com/assets/cms2/img/pokedex/full/025.png" alt="Pokémon" class="h-24 mx-auto mb-2" onerror="this.onerror=null;this.src='https://placehold.co/150x100/78716C/FFFFFF?text=Pokemon';">
                    <h3 class="font-bold text-lg">Pokémon</h3>
                </div>
                <div id="select-lorcana" class="bg-gray-700 p-4 rounded-lg text-center cursor-pointer border-2 border-transparent hover:border-purple-400 hover:bg-gray-600 transition-colors">
                    <img src="https://tcgbattle.netlify.app/images/lore.png" alt="Lorcana" class="h-24 mx-auto mb-2" onerror="this.onerror=null;this.src='https://placehold.co/150x100/78716C/FFFFFF?text=Lorcana';">
                    <h3 class="font-bold text-lg">Lorcana</h3>
                </div>
                <div class="bg-gray-700 p-4 rounded-lg text-center disabled-card relative flex flex-col justify-center items-center">
                    <h3 class="font-bold text-lg text-gray-400">Magic: The Gathering</h3>
                    <span class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-black bg-opacity-70 px-2 py-1 rounded text-sm">In Development</span>
                </div>
                <div class="bg-gray-700 p-4 rounded-lg text-center disabled-card relative flex flex-col justify-center items-center">
                    <h3 class="font-bold text-lg text-gray-400">Yu-Gi-Oh!</h3>
                    <span class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-black bg-opacity-70 px-2 py-1 rounded text-sm">In Development</span>
                </div>
                <div class="bg-gray-700 p-4 rounded-lg text-center disabled-card relative flex flex-col justify-center items-center">
                    <h3 class="font-bold text-lg text-gray-400">One Piece</h3>
                    <span class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-black bg-opacity-70 px-2 py-1 rounded text-sm">In Development</span>
                </div>
                 <div class="bg-gray-700 p-4 rounded-lg text-center disabled-card relative flex flex-col justify-center items-center">
                    <h3 class="font-bold text-lg text-gray-400">Dragonball Z</h3>
                    <span class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-black bg-opacity-70 px-2 py-1 rounded text-sm">In Development</span>
                </div>
            </div>
             <button id="back-to-home-from-tcg" class="mt-8 bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg">Back</button>
        </section>

        <div id="game-settings-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50">
            <div class="bg-gray-700 rounded-lg p-6 w-full max-w-md">
                <h2 class="text-2xl font-bold mb-4">Game Settings</h2>
                <div class="space-y-4">
                    <div>
                        <label class="font-bold">Player Name</label>
                        <input type="text" id="player-name-input" class="w-full bg-gray-800 border border-gray-600 rounded p-2 mt-1" placeholder="Enter your name">
                    </div>
                    <div id="prize-card-settings">
                        <label class="font-bold">Prize Cards</label>
                        <div class="flex space-x-2 mt-1">
                            <button data-prizes="6" class="prize-option-btn flex-1 bg-blue-600 text-white rounded p-2">6 (Standard)</button>
                            <button data-prizes="4" class="prize-option-btn flex-1 bg-gray-600 text-white rounded p-2">4 (Pre-Release)</button>
                        </div>
                    </div>
                    <div id="lorcana-lore-settings" class="hidden">
                        <label class="font-bold">Lore to Win</label>
                        <input type="number" id="lore-to-win-input" value="20" class="w-full bg-gray-800 border border-gray-600 rounded p-2 mt-1">
                    </div>
                    <div>
                        <label class="font-bold">Timer Type</label>
                        <div class="flex space-x-2 mt-1">
                            <button data-timer="countdown" class="timer-type-btn flex-1 bg-blue-600 text-white rounded p-2">Countdown</button>
                            <button data-timer="chess" class="timer-type-btn flex-1 bg-gray-600 text-white rounded p-2">Chess Clock</button>
                        </div>
                    </div>
                    <div id="countdown-timer-settings">
                        <label class="font-bold">Round Time (minutes)</label>
                        <input type="number" id="countdown-minutes" value="30" class="w-full bg-gray-800 border border-gray-600 rounded p-2 mt-1">
                    </div>
                    <div id="chess-timer-settings" class="hidden">
                        <label class="font-bold">Time Per Player (minutes)</label>
                        <input type="number" id="chess-minutes" value="20" class="w-full bg-gray-800 border border-gray-600 rounded p-2 mt-1">
                    </div>
                    <div id="number-of-games-settings">
                        <label class="font-bold">Number of Games</label>
                        <div class="flex space-x-2 mt-1">
                            <button data-mode="basic" class="game-mode-btn flex-1 bg-blue-600 text-white rounded p-2">Basic Swiss</button>
                            <button data-mode="bestOfThree" class="game-mode-btn flex-1 bg-gray-600 text-white rounded p-2">Best-of-Three</button>
                        </div>
                    </div>
                </div>
                <div class="mt-6 flex justify-end space-x-3">
                    <button id="cancel-settings-btn" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded">Cancel</button>
                    <button id="confirm-create-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">Create Battle</button>
                </div>
            </div>
        </div>
        
        <div id="join-session-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50">
            <div class="bg-gray-700 rounded-lg p-6 w-full max-w-md">
                <h2 class="text-2xl font-bold mb-4">Join Battle</h2>
                <div class="space-y-4">
                    <div>
                        <label class="font-bold">Your Name</label>
                        <input type="text" id="join-player-name" class="w-full bg-gray-800 border border-gray-600 rounded p-2 mt-1" placeholder="Enter your name">
                    </div>
                    <div>
                        <label class="font-bold">5-Digit Room Code</label>
                        <input type="text" id="room-code-input" maxlength="5" class="w-full bg-gray-800 border border-gray-600 rounded p-2 mt-1 text-center text-2xl tracking-widest" placeholder="_ _ _ _ _">
                    </div>
                </div>
                <div class="mt-6 flex justify-end space-x-3">
                    <button id="cancel-join-btn" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded">Cancel</button>
                    <button id="confirm-join-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">Join</button>
                </div>
            </div>
        </div>

        <div id="choose-first-player-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50">
            <div class="bg-gray-700 rounded-lg p-6 w-full max-w-md text-center">
                <h2 class="text-2xl font-bold mb-4">Who Goes First?</h2>
                <div id="first-player-options" class="space-y-3">
                </div>
            </div>
        </div>

        <div id="winner-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50">
            <div id="winner-card" class="bg-gray-700 rounded-lg p-8 w-full max-w-md text-center winner-animation">
                <i class="fas fa-trophy text-yellow-400 text-6xl mb-4"></i>
                <h2 id="winner-title" class="text-4xl font-bold mb-2">WINNER!</h2>
                <p id="winner-name" class="text-3xl font-bangers tracking-wider"></p>
                <div id="winner-modal-buttons" class="mt-6">
                </div>
            </div>
        </div>

        <div id="issue-win-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50">
            <div class="bg-gray-700 rounded-lg p-6 w-full max-w-md text-center">
                <h2 class="text-2xl font-bold mb-4">End Game</h2>
                <div id="issue-win-options" class="space-y-3">
                    <!-- Player buttons will be injected here -->
                </div>
                <button id="cancel-issue-win-btn" class="mt-4 bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded">Cancel</button>
            </div>
        </div>

        <section id="game-room-view" class="hidden min-h-screen flex flex-col p-2 sm:p-4">
            <header class="flex justify-between items-center mb-4">
                <div class="text-sm">
                    <p>Room: <span id="room-code-display" class="font-bold tracking-wider"></span></p>
                    <p id="player-role" class="font-bold"></p>
                </div>
                <div class="text-center">
                    <img src="https://tcgbattle.netlify.app/images/tcg_battle_logo.png" alt="TCG Battle Logo" class="h-10 mx-auto">
                </div>
                <div class="relative">
                    <button id="game-menu-btn" class="p-2"><i class="fas fa-bars fa-lg"></i></button>
                    <div id="game-menu-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-gray-700 rounded-md shadow-lg z-20">
                    </div>
                </div>
            </header>

            <main class="flex-grow flex flex-col items-center justify-center">
                <div id="waiting-for-opponent" class="text-center">
                    <h2 class="text-2xl font-bold">Waiting for opponent...</h2>
                    <p class="text-gray-400">Share the room code to let them join.</p>
                </div>

                <div id="game-controls" class="hidden w-full max-w-lg text-center">
                    <div id="game-status-info" class="mb-4 py-6 px-3 bg-gray-900 rounded-lg">
                         <p id="game-status-text" class="text-xl font-bold text-yellow-400"></p>
                         <div id="player-turn-info" class="flex justify-around items-center mt-4 px-4">
                             <div id="player1-turn-indicator" class="p-2 rounded-lg">
                                 <p id="player1-name-turn" class="font-bold"></p>
                             </div>
                             <div id="player2-turn-indicator" class="p-2 rounded-lg">
                                 <p id="player2-name-turn" class="font-bold"></p>
                             </div>
                         </div>
                    </div>
                    
                    <div id="timer-display-controls" class="mb-4 text-center"></div>
                    
                    <div id="pokemon-controls">
                        <h3 class="font-bold text-xl mb-2">Your Prize Cards</h3>
                        <div id="prize-card-grid" class="grid grid-cols-2 gap-3">
                        </div>
                    </div>

                    <div id="lorcana-controls" class="hidden">
                        <h3 class="font-bold text-xl mb-2">Your Lore</h3>
                        <div id="lore-tracker" class="flex flex-col items-center">
                        </div>
                    </div>
                    
                    <div id="turn-controls" class="mt-4">
                    </div>
                </div>
            </main>
        </section>

        <section id="presenter-view" class="hidden min-h-screen flex flex-col items-center justify-center p-4" style="background-color: #000000;">
            <div id="presenter-board" class="w-full max-w-7xl mx-auto relative">
                <div class="flex justify-between items-center">
                    <div id="presenter-p1-side" class="flex-1 flex flex-col items-center">
                        <div id="presenter-p1-avatar" class="w-32 h-32 md:w-48 md:h-48 p-2 rounded-lg bg-black bg-opacity-20 border-2 border-gray-500"></div>
                        <h2 id="presenter-p1-name" class="mt-2 text-2xl md:text-4xl font-bold text-white bg-black bg-opacity-20 px-4 py-1 rounded-md">Player 1</h2>
                        <p id="presenter-p1-wins" class="text-xl font-bold text-yellow-400 mt-2"></p>
                        <div id="presenter-p1-lore" class="flex items-center text-3xl font-bold mt-2 hidden"></div>
                    </div>
                    
                    <div class="flex-shrink-0 mx-8">
                        <img src="https://tcgbattle.netlify.app/images/tcg_battle_logo.png" alt="TCG Battle Logo" class="w-64 md:w-80">
                        <p id="presenter-game-number" class="text-center text-3xl font-bold text-white mt-4"></p>
                    </div>

                    <div id="presenter-p2-side" class="flex-1 flex flex-col items-center">
                        <div id="presenter-p2-avatar" class="w-32 h-32 md:w-48 md:h-48 p-2 rounded-lg bg-black bg-opacity-20 border-2 border-gray-500"></div>
                        <h2 id="presenter-p2-name" class="mt-2 text-2xl md:text-4xl font-bold text-white bg-black bg-opacity-20 px-4 py-1 rounded-md">Player 2</h2>
                        <p id="presenter-p2-wins" class="text-xl font-bold text-yellow-400 mt-2"></p>
                        <div id="presenter-p2-lore" class="flex items-center text-3xl font-bold mt-2 hidden"></div>
                    </div>
                </div>

                <div id="presenter-p1-prizes" class="presenter-prize-container absolute left-0 top-1/2 -translate-y-1/2"></div>
                <div id="presenter-p2-prizes" class="presenter-prize-container absolute right-0 top-1/2 -translate-y-1/2"></div>
                
                 <div id="presenter-timer-container" class="absolute bottom-[-80px] left-1/2 -translate-x-1/2 bg-black rounded-lg px-6 py-2 border-2 border-gray-600">
                     <div id="presenter-timer" class="text-5xl md:text-6xl font-mono font-bold tabular-nums text-yellow-300">00:00</div>
                     <div id="presenter-chess-timers" class="hidden w-full flex justify-around gap-8 text-4xl md:text-5xl font-mono font-bold tabular-nums">
                         <div id="presenter-chess-p1">00:00</div>
                         <div id="presenter-chess-p2">00:00</div>
                     </div>
                 </div>
            </div>
            <div class="absolute top-4 right-4 text-sm text-gray-300">Room: <span id="presenter-room-code" class="font-bold"></span></div>
            <button id="fullscreen-btn" class="absolute top-4 left-4 text-white bg-black bg-opacity-25 rounded-full w-10 h-10 flex items-center justify-center hover:bg-opacity-50">
                <i class="fas fa-expand"></i>
            </button>
        </section>

    </div>

    <!-- Load the main JavaScript module -->
    <script type="module" src="/js/main.js"></script>

</body>
</html>
